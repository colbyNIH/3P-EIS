# Software for 3P-EIS Analysis in MATLAB

This repository contains MATLAB software developed for analyzing electrophysiological data recorded from RPE or electronic models of epithelial tissues, particularly focusing on Electrical Impedance Spectroscopy (EIS) and related measurements. The software is designed to process and fit data generated in NOVA 2.1.5 software, combined with contiunous Trans-epithelial Potential (TEP) and intracellular pipette voltage recordings, simulate data, and present results in a structured format.

## Prerequisites

To use this software, ensure that you have the following prerequisites:

- MATLAB R2023a
- MATLAB Toolboxes:
    - Control System Toolbox
    - Symbolic Math Toolbox
    - Optimization Toolbox
    - Parallel Computing Toolbox
    - Signal Processing Toolbox

## Installation

1. Clone or download this repository to your local machine.
2. Open MATLAB and navigate to the downloaded directory.
3. Ensure all the required MATLAB Toolboxes are installed.

## Usage

Run the `main.m` file in MATLAB to start the analysis. This script:

- Loads and processes a lookup table of PhD data.
- Simulates data (if enabled) and fits NOVA data.
- Presents and stores the results in an output lookup table.

The default settings in main.m are as per the configurations used in our published paper (DOI: [10.1152/ajpcell.00200.2023](https://doi.org/10.1152/ajpcell.00200.2023)).

### Data Format

The data subfolder is where all raw data is expected. The expected format of the data is as follows:

- A folder with a name that defines a prefix for all files inside the folder. In our data, we generated a timestamp for each recording as the folder and file prefix.
- The data generated by NOVA 2.1.5 was saved to the file with the suffix '_NOVAdata.txt.' Each time point for a continuous recording is marked by a date row in 'NOVAdata.txt. (e.g., 10/14/2021). This file contains all trans-epithelial resistance and reactance values for each measured frequency.
- The order of the measurements in 'NOVAdata.txt' is matched with a high-speed, continuous recording of the TEP and intracellular voltage. For example, the continuously measured data for the first frequency sweep in 'NOVAdata.txt' is matched with the time series data in the file with suffix '_1.txt' and the second is matched with '_2.txt' and so on.
- The first column in the high-speed, continuous data (e.g., '_1.txt') is expected to contain the intracellular voltage and the second column is expected to be the TEP (both measured in Volts).
- The sampling rate for the continuous data is saved in the file suffix '_samplingRate.txt.'
- A lower sampling rate, continuous recording of the TEP, the intracellular voltages, and the TTL signal (high when the Metrohm Autolab PGSTAT was performing a frequency sweep and low between measurements) is included in the file suffix '_data.txt'). The absolute computer time between sampling points was recorded in the first column.
- Any user generated comments related to treatments (espectially when treating cells with compounds like ATP) are stored in '_comments.txt' and are associated with an absolute time that matches the value in '_data.txt.'

### Main Script

- `main.m` - The primary script to run the analysis.

### Subfunctions

#### Required by `main.m`

- `analyzeDataTable.m`
- `buildMeasIDXarray.m`
- `checkForLTissues.m`
- `getCrossSection.m`
- `importMeasuredData.m`
- `removeCompletedFits.m`
- `simFrequencyData.m`
- `simplifyDataForSaving.m`
- `simVoltageData.m`

#### Required by `analyzeDataTable.m`

- `appendFitResultsToDataTable.m`
- `calcSignalAmplitudes.m`
- `calcVb.m`
- `fitMembraneParameters.m`
- `preprocessData.m`

#### Other Dependencies

- `readNOVA.m`
- `calcExtraFrequencyInfo.m`
- `getAmplitudes.m`

## Support

For questions or access to additional raw data, contact Craig Forest at cforest@gatech.edu.

## Acknowledgments

This work was supported by the following grants:

- National Institutes of Health Grants:
  - RF1AG079269
  - R01NS102727
  - 1U01MH106027
  - R01DA029639
- National Science Foundation Graduate Research Fellowship Program
- National Eye Institute Intramural Research Program to K.B.

Special thanks to the team members involved in the conception, design, experimentation, and manuscript preparation:

- C.F.L., A.M., K.B., and C.R.F. (concept and design)
- C.F.L., R.H., D.R. and R.S. (experiments)
- C.F.L. (data analysis)
- C.F.L., A.C., A.M., Q.W., K.B., and C.R.F. (interpretation of results)
- C.F.L., A.C., K.B., and C.R.F. (manuscript drafting)
- C.F.L., A.C., A.M., R.H., Q.W., K.B., and C.R.F. (manuscript editing and approval)
